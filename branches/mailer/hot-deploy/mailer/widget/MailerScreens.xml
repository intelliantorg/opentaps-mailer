<?xml version="1.0" encoding="UTF-8"?>

<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">

	<screen name="main-section-decorator">
        <section>
            <actions>
            	<property-map resource="UILabels" map-name="uiLabelMapExt" global="true"/>
                <set field="sectionName" value="marketing" global="true"/>
                <set field="sectionStyle" value="twoColumn"/>
                <set field="leftBarScreen" value="component://mailer/widget/CommonScreens.xml#leftBarScreen"/>
            </actions>
            <widgets>
                <include-screen name="main-section-template" location="component://opentaps-common/widget/screens/common/CommonScreens.xml"/>
            </widgets>
        </section>
    </screen>
        
    <screen name="createMarketingCampaignForm">
        <section>
            <condition><if-has-permission permission="CRMSFA_CAMP" action="_CREATE"/></condition>
            <actions>
                <set field="pageTitleLabel" value="CreateCampaignHeader"/>
                <set field="sectionHeaderUiLabel" value="CreateCampaignHeader"/>
                <!-- NOT sure why this is NOT working 
                <entity-and list="statusItems" entity-name="StatusItem">
                	<field-map field-name="statusTypeId" value="MKTG_CAMP_STATUS"/>
                	<order-by field-name="sequenceId"/>
                </entity-and>
                -->
			</actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <platform-specific><html><html-template location="component://mailer/webapp/mailer/createCampaign.ftl"/></html></platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
            <fail-widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <label style="head2">Permission denied</label>
                    </decorator-section>
                </decorator-screen>
            </fail-widgets>
        </section>
    </screen>

	<screen name="findMarketingCampaigns">
        <section>
            <actions>
                <set field="pageTitleLabel" value="FindCampaignsHeader"/>
                <set field="sectionHeaderUiLabel" value="FindCampaignsHeader"/>
                <set field="parameters.listIteratorNameToUse" value="campaignsListIt"/> <!-- iterator for list of accounts -->
                <set field="listSortTarget" value="findMarketingCampaigns"/>
                <set field="findMarketingCampaignsTarget" value="findMarketingCampaigns"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/pagination.bsh"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/findMarketingCampaigns.bsh"/>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <container style="subSectionBlock">
                            <container style="form">
                                <include-form name="FindMarketingCampaign" location="component://mailer/widget/forms/MailerForms.xml"/>
                            </container>
                        </container>
                        <container style="subSectionBlock">
                            <container style="subSectionHeader"><label style="subSectionTitle">${uiLabelMap.CrmMarketingCampaigns}</label></container>
                            <include-form name="ListMarketingCampaigns" location="component://mailer/widget/forms/MailerForms.xml"/>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
	<screen name="createContactListForm">
        <section>
            <condition><if-has-permission permission="CRMSFA_CAMP" action="_UPDATE"/></condition>
            <actions>
                <set field="pageTitleLabel" value="CreateContactListHeader"/>
                <set field="sectionHeaderUiLabel" value="CreateContactListHeader"/>
                <entity-condition entity-name="MarketingCampaign" list="marketingCampaignList" list-name="marketingCampaignList">
                	<condition-list combine="and">
                		<condition-expr field-name="statusId" operator="not-equals" value="MKTG_CAMP_COMPLETED"/>
                		<condition-expr field-name="statusId" operator="not-equals" value="MKTG_CAMP_CANCELLED"/>
                	</condition-list>
                    <order-by field-name="campaignName"/>
                </entity-condition>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <platform-specific><html><html-template location="component://mailer/webapp/mailer/createContactList.ftl"/></html></platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
            <fail-widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <label style="head2">${uiLabelMap.CrmErrorPermissionDenied}</label>
                    </decorator-section>
                </decorator-screen>
            </fail-widgets>
        </section>
    </screen>
    
    <screen name="findContactLists">
        <section>
            <actions>
                <set field="pageTitleLabel" value="FindContactListHeader"/>
                <set field="sectionHeaderUiLabel" value="FindContactListHeader"/>
                <set field="parameters.listIteratorNameToUse" value="contactLists"/> <!-- iterator for list of contacts -->
                <set field="listSortTarget" value="findContactLists"/>
                <set field="findContactListsTarget" value="findContactLists"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/pagination.bsh"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/findContactLists.bsh"/>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <container style="subSectionBlock">
                            <container style="form">
                                <include-form name="FindContactList" location="component://mailer/widget/forms/MailerForms.xml"/>
                            </container>
                        </container>
                        <container style="subSectionBlock">
                            <container style="subSectionHeader"><label style="subSectionTitle">${uiLabelMap.CrmContactLists}</label></container>
                            <include-form name="ListContactLists" location="component://mailer/widget/forms/MailerForms.xml"/>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- Merge Forms -->
    <screen name="manageMergeForms">
        <section> 
            <condition><if-has-permission permission="CRMSFA_CAMP" action="_UPDATE"/></condition>
            <actions>
                <set field="pageTitleLabel" value="CrmFormLetterTemplates"/>    <!-- this is uiLabelMap property for the title of the HTML page -->
                <set field="sectionHeaderUiLabel" value="CrmFormLetterTemplates"/>  <!-- this is for the main section of this page, ie <h2> -->
                <set field="mergeFormLookupEntity" value="MergeFormAndCategory"/>  <!-- Override the entity name in getMergeFormsForCurrentUser.bsh -->
                <script location="component://opentaps-common/webapp/common/WEB-INF/actions/includes/getMergeFormsForCurrentUser.bsh"/>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">                     
                        <platform-specific><html><html-template location="component://mailer/webapp/mailer/listMergeForms.ftl"/></html></platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="viewMarketingCampaign">
        <section>
            <actions>
                <set field="pageTitleLabel" value="ViewCampaignHeader"/>
                <set field="sectionHeaderUiLabel" value="ViewCampaignHeader"/>
                <set field="listSortTarget" value="viewMarketingCampaign"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/viewMarketingCampaign.bsh"/>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <container style="subSectionBlock">
                            <platform-specific><html><html-template location="component://mailer/webapp/mailer/viewMarketingCampaign.ftl"/></html></platform-specific>                            
                            <container style="form">
                                <include-form name="viewMarketingCampaign" location="component://mailer/widget/forms/MailerForms.xml"/>
                            </container>
                        </container>
						<container style="subSectionBlock">
                            <platform-specific><html><html-template location="component://mailer/webapp/mailer/contactListsMenu.ftl"/></html></platform-specific>
                            <include-form name="ListMarketingCampaignContactLists" location="component://mailer/widget/forms/MailerForms.xml"/>
                            <include-form name="addContactListToMailerMarketingCampaignForm" location="component://mailer/widget/forms/MailerForms.xml"/>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="updateMarketingCampaignForm">
        <section>
            <condition><if-has-permission permission="CRMSFA_CAMP" action="_UPDATE"/></condition>
            <actions>
                <set field="pageTitleLabel" value="UpdateCampaignHeader"/>
                <set field="sectionHeaderUiLabel" value="UpdateCampaignHeader"/>
                <set field="listSortTarget" value="viewMarketingCampaign"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/viewMarketingCampaign.bsh"/>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <container style="subSectionBlock">
                            <!-- <platform-specific><html><html-template location="component://mailer/webapp/mailer/viewMarketingCampaign.ftl"/></html></platform-specific> -->                            
                            <container style="form">
                                <include-form name="updateMarketingCampaignForm" location="component://mailer/widget/forms/MailerForms.xml"/>
                            </container>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
            <fail-widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <label style="head2">Permission denied</label>
                    </decorator-section>
                </decorator-screen>
            </fail-widgets>
        </section>
    </screen>
    
    <screen name="viewContactList">
        <section>
            <actions>
                <set field="pageTitleLabel" value="ViewContactListHeader"/>
                <set field="sectionHeaderUiLabel" value="ViewContactListHeader"/>
                <set field="parameters.listIteratorNameToUse" value="contactListParties"/> <!-- iterator for list of parties -->
                <set field="listSortTarget" value="viewContactList"/>
                <set field="findContactListPartiesTarget" value="viewContactList"/>
                <set field="listContactListPartiesTarget" value="removeContactListParties"/>
                <set field="isContactListSearch" value="Y"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/pagination.bsh"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/viewContactList.bsh"/>
                <script location="component://mailer/webapp/mailer/WEB-INF/actions/findContactListParties.bsh"/>
            </actions>
            <widgets>
                <decorator-screen name="main-section-decorator">
                    <decorator-section name="section-body">
                        <container style="subSectionBlock">
                            <platform-specific><html><html-template location="component://crmsfa/webapp/crmsfa/marketing/submenus/viewContactListMenu.ftl"/></html></platform-specific>
                            <container style="form">
                                <include-form name="viewContactList" location="component://mailer/widget/forms/MailerForms.xml"/>
                            </container>
                        </container>
                        <container style="subSectionBlock">
                            <container style="subSectionHeader"><label style="subSectionTitle">${uiLabelMap.CrmFindContactListParties}</label></container>
                            <container style="form">
                                <include-form name="FindContactListParties" location="component://crmsfa/widget/crmsfa/forms/marketing/ContactListForms.xml"/>
                            </container>
                        </container>

                        <container style="subSectionBlock">
                            <platform-specific><html><html-template location="component://crmsfa/webapp/crmsfa/marketing/submenus/contactListPartiesMenu.ftl"/></html></platform-specific>
                            <include-form name="ListContactListParties" location="component://crmsfa/widget/crmsfa/forms/marketing/ContactListForms.xml"/>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
</screens>     
