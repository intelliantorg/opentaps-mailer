<?xml version="1.0" encoding="UTF-8"?>

<forms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-form.xsd">
	<form name="viewMarketingCampaign" type="single" title="View Marketing Campaign" default-map-name="marketingCampaign"
        default-title-style="tableheadtext" default-widget-style="tabletext" default-tooltip-style="tabletext">
        
        <field name="campaignName" title="${uiLabelMap.CommonName}" position="1"><display/></field>
        <field name="statusId" title="${uiLabelMap.CommonStatus}" position="2">
            <display-entity entity-name="StatusItem"/>
        </field>
        <field name="fromDate" title="${uiLabelMap.CommonFrom}" position="1"><display/></field>
        <field name="fromEmailAddress" title="${uiLabelMap.LabelFromEmailAddress}" position="2"><display/></field>
        <field name="thruDate" title="${uiLabelMap.CommonThru}" position="1"><display/></field>
        <field name="templateId" title="${uiLabelMap.LabelTemplateId}" position="2"><display/></field>      
        <field name="campaignSummary" title="${uiLabelMap.CommonDescription}"><display/></field>
    </form>
    
    <form name="FindMarketingCampaign" type="single" target="${findMarketingCampaignsTarget}"
        default-title-style="tableheadtext" default-widget-style="inputBox" default-tooltip-style="tabletext">

        <field name="campaignName" title="${uiLabelMap.CommonName}"><text/></field>
        <field name="statusId" title="${uiLabelMap.CommonStatus}" position="1">
            <drop-down allow-empty="true">
                <entity-options entity-name="StatusItem" description="${description}">
                    <entity-constraint name="statusTypeId" value="MKTG_CAMP_STATUS"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>

        <field name="submitButton" title="${uiLabelMap.CrmFindMarketingCampaigns}" widget-style="smallSubmit"><submit/></field>
    </form>
    
    <form name="ListMarketingCampaigns" type="list" separate-columns="true" 
        title="MarketingCampaigns"  default-title-style="tableheadtext" target=""
        default-widget-style="tabletext" default-tooltip-style="tabletext"
        default-table-style="crmsfaListTable" header-row-style="crmsfaListTableHeader" even-row-style="rowWhite" odd-row-style="rowLightGray"
        paginate-target="${listSortTarget}" paginate-target-anchor="ListMarketingCampaigns" paginate-size-field="campaignsSize" paginate-index-field="campaignsIndex"
        list-name="campaignsListIt">

        <field name="campaignName" title="${uiLabelMap.CommonName}" widget-style="linktext"
            header-link="${listSortTarget}?campaignsOrderBy=campaignName${findParams}#ListMarketingCampaigns" header-link-style="orderByHeaderLink">
            <hyperlink description="${campaignName} (${marketingCampaignId})" target="viewMarketingCampaign?marketingCampaignId=${marketingCampaignId}"/>
        </field>
        <field name="statusId" title="${uiLabelMap.CommonStatus}"
            header-link="${listSortTarget}?campaignsOrderBy=statusId${findParams}#ListMarketingCampaigns" header-link-style="orderByHeaderLink">
            <display-entity entity-name="StatusItem"/>
        </field>
        <field name="fromDate" red-when="never" title="${uiLabelMap.CommonFrom}"><display/></field>
        <field name="thruDate" red-when="never" title="${uiLabelMap.CommonThru}"><display/></field>       
        <field name="ss" title="${uiLabelMap.CommonSelect}"><check /></field>
    </form>
    
    <form id="updateMarketingCampaignForm" name="updateMarketingCampaignForm" type="single" title="Create Marketing Campaign" default-map-name="marketingCampaign" target="updateMarketingCampaign"
        default-title-style="tableheadtext" default-widget-style="inputBox" default-tooltip-style="tabletext">

        <field name="marketingCampaignId"><hidden/></field>
        <field widget-style="inputBox required" title-style="requiredField" name="campaignName" title="${uiLabelMap.CommonName}"><text/></field>
        <field name="fromEmailAddress" widget-style="inputBox required email" title-style="requiredField" title="${uiLabelMap.LabelFromEmailAddress}" position="2"><text/></field>
        <field name="fromDate" title="${uiLabelMap.CommonFrom}" position="1">
            <date-time type="timestamp" input-method="time-dropdown" clock="12"/>
        </field>
        <!-- <field name="templateId" widget-style="inputBox required" title-style="requiredField" title="${uiLabelMap.LabelTemplateId}" position="2"><text/></field> -->
        <field name="templateId" title-style="requiredField" widget-style="inputBox required" title="${uiLabelMap.LabelTemplateId}" position="2">
            <drop-down allow-empty="false">
                <entity-options entity-name="MergeForm" key-field-name="mergeFormId" description="${description}">
                    <entity-order-by field-name="description"/>
                </entity-options>
            </drop-down>
        </field>
 
        
        <field name="thruDate" title="${uiLabelMap.CommonThru}" position="1">
            <date-time type="timestamp" input-method="time-dropdown" clock="12"/>
        </field>
        <field name="statusId" title-style="requiredField" widget-style="inputBox required" title="${uiLabelMap.CommonStatus}" position="2">
            <drop-down allow-empty="false">
                <entity-options entity-name="StatusItem" key-field-name="statusId" description="${description}">
                    <entity-constraint name="statusTypeId" value="MKTG_CAMP_STATUS"/>
                    <entity-order-by field-name="sequenceId"/>
                </entity-options>
            </drop-down>
        </field>     
       
        <field name="campaignSummary" title="${uiLabelMap.CommonDescription}"><textarea/></field>

        <field name="submitButton" title="${uiLabelMap.CommonUpdate}" widget-style="smallSubmit"><submit button-type="button"/></field>
    </form>
    
    <form name="createContactListForm" type="single" title="Create Contact List" target="createContactList"
        default-title-style="tableheadtext" default-widget-style="inputBox" default-tooltip-style="tabletext">
        <field name="contactListName" title="${uiLabelMap.CommonName}" title-style="requiredField"><text/></field>
        <field name="contactListTypeId"><hidden value="MARKETING"/></field>
        <field name="marketingCampaignId" title="${uiLabelMap.CrmMarketingCampaign}">
            <drop-down allow-empty="true" current="selected">
                <entity-options description="${campaignName}" entity-name="MarketingCampaign">
                    <entity-constraint name="statusId" operator="not-equals" value="MKTG_CAMP_CANCELLED"/>
                    <entity-constraint name="statusId" operator="not-equals" value="MKTG_CAMP_COMPLETED"/>
                    <entity-order-by field-name="campaignName"/>
                </entity-options>
            </drop-down>
        </field>
        <field name="contactMechTypeId" title="${uiLabelMap.CrmContactType}" title-style="requiredField" position="1">
            <drop-down allow-empty="false">
                <option key="EMAIL_ADDRESS" description="Email Address"/>
                <option key="POSTAL_ADDRESS" description="Postal Address"/>
                <option key="TELECOM_NUMBER" description="Phone Number"/>
            </drop-down>
        </field>
        <field name="description" title="${uiLabelMap.CommonDescription}"><textarea/></field>

        <field name="submitButton" title="${uiLabelMap.CrmCreateContactList}" widget-style="smallSubmit"><submit button-type="button"/></field>
    </form> 
    
    <form name="FindContactList" type="single" target="${findContactListsTarget}"
        default-title-style="tableheadtext" default-widget-style="inputBox" default-tooltip-style="tabletext">

        <field name="lookup"><hidden value="Y"/></field>
        <field name="contactListId"><hidden/></field>
        <field name="contactListName" title="${uiLabelMap.CommonName}"><text/></field>
        <field name="contactMechTypeId" title="${uiLabelMap.CrmContactType}" position="1">
            <drop-down allow-empty="true">
                <option key="EMAIL_ADDRESS" description="Email Address"/>
                <option key="POSTAL_ADDRESS" description="Postal Address"/>
                <option key="TELECOM_NUMBER" description="Phone Number"/>
            </drop-down>
        </field>

        <field name="submitButton" title="${uiLabelMap.CrmFindContactLists}" widget-style="smallSubmit"><submit/></field>
    </form>
    
    <form name="ListContactLists" type="list" separate-columns="true" 
        title="List Contact Lists"  default-title-style="tableheadtext" target=""
        default-widget-style="tabletext" default-tooltip-style="tabletext"
        default-table-style="crmsfaListTable" header-row-style="crmsfaListTableHeader" even-row-style="rowWhite" odd-row-style="rowLightGray"
        paginate-target="${listSortTarget}"  paginate-target-anchor="ListContactLists"
        paginate-size-field="contactListsSize" paginate-index-field="contactListsIndex"
        list-name="contactLists">

        <field name="contactListId" title="${uiLabelMap.CommonName}" widget-area-style="fieldWidth300" widget-style="linktext">
            <hyperlink description="${contactListName} (${contactListId})" target="viewContactList?contactListId=${contactListId}"/>
        </field>
        <field name="contactMechTypeId" title="${uiLabelMap.CrmContactType}">
            <display-entity entity-name="ContactMechType"/>
        </field>
        <field name="" title="${uiLabelMap.CrmNumberOfMembers}">
            <display description="${bsh:com.opensourcestrategies.crmsfa.marketing.MarketingHelper.countContactListMembers(contactListId, delegator)}"/>
        </field>
    </form>

   	<form name="ListMarketingCampaignContactLists" type="list" separate-columns="true" 
        title="List Marketing Campaign Contact Lists"  default-title-style="tableheadtext" target=""
        default-widget-style="tabletext" default-tooltip-style="tabletext"
        default-table-style="crmsfaListTable" header-row-style="crmsfaListTableHeader" even-row-style="rowWhite" odd-row-style="rowLightGray"
        list-name="marketingCampaignContactLists">
        
        <field name="contactListId" title="Segment" widget-area-style="fieldWidth300" widget-style="linktext" use-when="contactListId!=null">
            <hyperlink description="${contactListName} (${contactListId})" target="viewContactList?contactListId=${contactListId}"/>
        </field>

        <field name="contactMechTypeId" title="${uiLabelMap.CrmContactType}" use-when="contactListId!=null">
            <display-entity entity-name="ContactMechType"/>
        </field>
        <field name="" title="${uiLabelMap.CrmNumberOfMembers}" use-when="contactListId!=null">
            <display description="${bsh:com.opensourcestrategies.crmsfa.marketing.MarketingHelper.countContactListMembers(contactListId, delegator)}"/>
        </field>

        <field name="remove" title="" widget-style="buttontext" use-when="contactListId!=null">
          <hyperlink target="removeContactListFromMarketingCampaign?marketingCampaignId=${marketingCampaignId}&amp;campaignListId=${campaignListId}" description="${uiLabelMap.CommonRemove}" />
        </field>
    </form>
    
    <form name="addContactListToMailerMarketingCampaignForm" type="single" target="addContactListToMailerMarketingCampaign"
        default-title-style="tableheadtext" default-widget-style="inputBox" default-tooltip-style="tabletext">
        <field name="marketingCampaignId"><hidden/></field>
        <field name="contactListId" title="${uiLabelMap.CrmContactList}" title-style="requiredField">
        	<lookup target-form-name="LookupContactList" size="15"/>
        </field>
        <field name="submitButton" title="${uiLabelMap.CrmAddContactList}" widget-style="smallSubmit"><submit button-type="button"/></field>
    </form>
    
    <form name="viewContactList" type="single" title="View Contact List" default-map-name="contactList"
        default-title-style="tableheadtext" default-widget-style="tabletext" default-tooltip-style="tabletext">
        <field name="contactListName" title="${uiLabelMap.CommonName}" position="1"><display/></field>
        <field name="contactMechTypeId" title="${uiLabelMap.CrmContactType}" position="1">
            <display-entity entity-name="ContactMechType"/>
        </field>
        <field name="description" title="${uiLabelMap.CommonDescription}"><display/></field>
        <field name="numberOfMembers" title="${uiLabelMap.CrmNumberOfMembers}">
            <display/>
        </field>
        <!-- 
        <field name="calculate3605Postage" title="" widget-style="buttontext" 
            use-when="&quot;POSTAL_ADDRESS&quot;.equals(contactList.get(&quot;contactMechTypeId&quot;))">
            <hyperlink description="${uiLabelMap.CrmCalculate3605Postage}" target="calculate3605Postage?contactListId=${contactList.contactListId}"/>
        </field>
        <field name="sortUSPSBusinessMail" title="" widget-style="buttontext"
            use-when="&quot;POSTAL_ADDRESS&quot;.equals(contactList.get(&quot;contactMechTypeId&quot;))">
            <hyperlink description="${uiLabelMap.CrmSortUSPSBusinessMail}" target="sortUSPSBusinessMail?contactListId=${contactList.contactListId}"/>
        </field>
        <field name="viewUSPSSortResult" title="" widget-style="buttontext" 
            use-when="&quot;POSTAL_ADDRESS&quot;.equals(contactList.get(&quot;contactMechTypeId&quot;))">
            <hyperlink description="${uiLabelMap.CrmReportUSPSHeader}" target="viewUSPSSortResult?contactListId=${contactList.contactListId}"/>
        </field>
        -->
    </form>
    
     <form name="ListContactListParties" type="multi" separate-columns="false" use-row-submit="true"
        title="Contact List Parties"  default-title-style="tableheadtext" target="${listContactListPartiesTarget}?contactListId=${parameters.contactListId}"
        default-widget-style="tabletext" default-tooltip-style="tabletext"
        default-table-style="crmsfaListTable" header-row-style="crmsfaListTableHeader" even-row-style="rowWhite" odd-row-style="rowLightGray"
        paginate-target="${listSortTarget}" paginate-target-anchor="ListContactListParties" 
        paginate-size-field="contactListPartiesSize" paginate-index-field="contactListPartiesIndex"
        list-name="contactListParties">

        <!-- display the name as a link to viewAccount, viewContact or viewLead according to the role type -->
        <field name="partyId" title="${uiLabelMap.CommonName}" widget-style="linktext"
            header-link="${listSortTarget}?contactListId=${parameters.contactListId}&amp;contactListPartyOrderBy=name&amp;${findParams}#ListContactListParties" 
            header-link-style="orderByHeaderLink">
            <display description="${bsh:com.opensourcestrategies.crmsfa.party.PartyHelper.createViewPageLink(partyId, delegator, externalLoginKey);}"/>
        </field>
        <!-- for adding member -->
        <field name="statusId" use-when="isRemoveForm!=true"><hidden value="CLPT_ACCEPTED"/></field>
        <field name="preferredContactMechId" use-when="isRemoveForm!=true"><hidden value="${contactMechId}"/></field>

        <!-- for removing member (with partyId) -->
        <field name="contactMechId" use-when="isRemoveForm==true"><hidden/></field>
        <field name="fromDate" use-when="isRemoveForm==true"><hidden value="${memberFromDate}"/></field>
        <field name="thruDate" use-when="isRemoveForm==true"><hidden value="${nowTimestamp}"/></field>

        <!-- TODO: the description should be generated using a Java helper, which in turn relies on localized formatters -->
        <field name="infoString" title="${contactMechColumnName}"
            header-link="${listSortTarget}?contactListId=${parameters.contactListId}&amp;contactListPartyOrderBy=description&amp;${findParams}#ListContactListParties" 
            header-link-style="orderByHeaderLink">
            <display description="${bsh:
                if (&quot;EMAIL_ADDRESS&quot;.equals(contactMechTypeId)) return infoString; 
                if (&quot;TELECOM_NUMBER&quot;.equals(contactMechTypeId)) return &quot;(&quot;+areaCode+&quot;) &quot;+contactNumber;
                if (! &quot;POSTAL_ADDRESS&quot;.equals(contactMechTypeId)) return null;
                buff = new StringBuffer();
                if (address1 != null) buff.append(address1).append(&quot;, &quot;);
                if (city != null) buff.append(city).append(&quot;, &quot;);
                if (stateProvinceGeoId != null) buff.append(stateProvinceGeoId).append(' ');
                if (postalCode != null) buff.append(postalCode);
                return buff.toString();}"/>
        </field>

		
        <!-- convenience log a call shortcut -->
        <!-- <field name="logCall" title=" " use-when="isPhoneList==true&amp;&amp;isRemoveForm==true" widget-style="buttontext">
            <hyperlink description="${uiLabelMap.CrmLogCall}"
                target="logTaskForm?partyId=${partyId}&amp;workEffortPurposeTypeId=WEPT_TASK_PHONE_CALL"/>
        </field> -->
        <!-- convenience write email shortcut -->
        <!-- <field name="writeEmail" title=" " use-when="isEmailList==true&amp;&amp;isRemoveForm==true" widget-style="buttontext">
            <hyperlink description="${uiLabelMap.CrmWriteEmail}"
                target="writeEmail?contactMechIdTo=${contactMechId}&amp;internalPartyId=${partyId}&amp;donePage=viewContactList&amp;contactListId=${contactListId}"/>
        </field> -->
        <!-- above fields will misalign Select column for address, so force aligment with a dummy field -->
        <!-- <field name="dummyField" title=" " use-when="isAddressList==true||isRemoveForm==false">
            <display description=" "/>
        </field> -->

        <!-- add a create order link for the removable party list -->
        <!-- <field name="createOrder" title=" " widget-style="buttontext" use-when="isRemoveForm==true">
            <hyperlink description="${uiLabelMap.OpentapsCreateOrder}" target="newOrder?partyId=${partyId}"/>
        </field> -->
        <!-- another dummy field to compensate for create order column -->
        <!-- <field name="dummyField2" title="  " use-when="isRemoveForm==false">
            <display description=" "/>
        </field> -->

        <field name="_rowSubmit" title="${uiLabelMap.CommonSelect}" use-when="hasUpdatePermission!=void&amp;&amp;hasUpdatePermission==true"><check/></field>

        <!-- since the form action could be to add or remove selected, the button name must be set in a .bsh file (no other method seems to work) -->
        <!-- 
        <field name="submitButton" title="${listFormSubmitButtonName}" widget-style="smallSubmit" 
            use-when="hasUpdatePermission!=void&amp;&amp;hasUpdatePermission==true">
            <submit/>
        </field>
        -->
    </form>    
</forms>