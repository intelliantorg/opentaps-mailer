<?xml version="1.0" encoding="UTF-8"?>

<entitymodel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.ofbiz.org/dtds/entitymodel.xsd">
    <title>Entity definitions for mailer</title>    
    <author>IntelliAnt</author>

	<!-- Entity definitions and extensions -->
    <entity entity-name="MailerMarketingCampaign" package-name="net.intelliant.mailer" title="Mailer Marketing Campaign Entity">
    	<field name="marketingCampaignId" type="id-ne"/>
    	<field name="fromEmailAddress" type="id-long" not-null="true"/>
    	<field name="templateId" type="id" not-null="true"/>        
    	<prim-key field="marketingCampaignId"/>
    	<relation type="one" fk-name="MMC_TO_MKTGCPN" rel-entity-name="MarketingCampaign">
        	<key-map field-name="marketingCampaignId"/>
      	</relation>
      	<relation type="one" fk-name="MMC_TO_MERGEFORM" rel-entity-name="MergeForm">
        	<key-map field-name="templateId" rel-field-name="mergeFormId"/>
      	</relation>
    </entity> 

    <entity entity-name="MailerMarketingCampaignAndContactList" package-name="net.intelliant.mailer" title="Associate contact lists to mailer marketing campaigns">
        <field name="campaignListId" type="id-ne"/>
        <field name="marketingCampaignId" type="id-ne"/>
        <field name="contactListId" type="id-ne"/>
        <field name="fromDate" type="date-time"/>
        <field name="thruDate" type="date-time"/>
        <field name="createdByUserLogin" type="id-vlong"/>
        <field name="lastModifiedByUserLogin" type="id-vlong"/>
        <prim-key field="campaignListId"/>
        <relation type="one" fk-name="MMCACL_TO_MC" rel-entity-name="MarketingCampaign">
            <key-map field-name="marketingCampaignId"/>
        </relation>
        <relation type="one" fk-name="MMCACL_TO_CL" rel-entity-name="ContactList">
            <key-map field-name="contactListId"/>
        </relation>
    </entity>
    
	<extend-entity entity-name="MergeForm">
		<field name="scheduleAt" type="id"/>
		<field name="mergeFormTypeId" type="id"/>
		<field name="fromEmailAddress" type="email"/>
		<field name="headerImageLocation" type="long-varchar"/>
		<field name="footerImageLocation" type="long-varchar"/>
		<relation type="one" fk-name="MF_TO_MFT" rel-entity-name="MergeFormType">
            <key-map field-name="mergeFormTypeId"/>
        </relation>
	</extend-entity>
	
	<entity entity-name="MailerRecipient" package-name="net.intelliant.mailer" title="Mailer recipient">
    	<field name="recipientId" type="id-ne"/>
    	<field name="firstName" type="name" not-null="true">
    		<description>First Name</description>
    	</field>
    	<field name="middleName" type="name">
    		<description>Middle Name</description>
    	</field>
    	<field name="lastName" type="name" not-null="true">
    	 	<description>Last Name</description>
    	</field>    	
    	<field name="emailAddress" type="email">
    	 	<description>Email Address</description>
    	</field>
    	<field name="phoneNo" type="tel-number">
    	 	<description>Phone No</description>
    	</field>
    	<field name="mobileNo" type="tel-number" not-null="true">
    	 	<description>Mobile No</description>
    	</field>   	
    	<field name="organisationName" type="name">
    	 	<description>Organisation Name</description>
    	</field>
    	<field name="address1" type="name" not-null="true">
    	 	<description>Address line 1</description>
    	</field>
    	<field name="address2" type="name">
    	 	<description>Address line 2</description>
    	</field>	
    	<field name="postalCode" type="numeric">
    	 	<description>Postal code</description>
    	</field>	
    	<field name="stateName" type="name">
    	 	<description>State</description>
    	</field>	
    	<field name="countyName" type="name">
    	 	<description>Country</description>
    	</field>

    	<field name="importedOnDateTime" type="date-time"/>
    	<field name="importedByUserLogin" type="id-vlong"/>
    	<prim-key field="recipientId"/>
   	</entity>
   	   	
   	<entity entity-name="MailerRecipientContactList" package-name="net.intelliant.mailer" title="Mailer recipient">
    	<field name="contactListId" type="email"/>
    	<field name="recipientId" type="id-ne"/>
    	
      	<relation type="one" fk-name="MRCL_TO_CL" rel-entity-name="ContactList">
        	<key-map field-name="contactListId"/>
      	</relation>
    	<relation type="one" fk-name="MRCL_TO_MR" rel-entity-name="MailerRecipient">
        	<key-map field-name="recipientId"/>
      	</relation>
    	<prim-key field="recipientId"/>
    	<prim-key field="contactListId"/>
   	</entity>
   	
	<entity entity-name="MailerCampaignStatus" package-name="net.intelliant.mailer" title="To track campaign status">
    	<field name="campaignStatusId" type="id-ne"/>
    	<field name="recipientId" type="id-ne"/>
    	<field name="contactListId" type="id-ne"/> <!-- indicates customer was added as part of this contact list -->
    	<field name="marketingCampaignId" type="id-ne"/>
    	<field name="scheduledForDate" type="date"/>
		<field name="statusId" type="id-ne"/>
    	<field name="actualExecutionDateTime" type="date-time"/>
    	<prim-key field="campaignStatusId"/>
    	<relation type="one" fk-name="MCS_TO_MKTGCPN" rel-entity-name="MarketingCampaign">
        	<key-map field-name="marketingCampaignId"/>
      	</relation>
      	<relation type="one" fk-name="MCS_TO_MC" rel-entity-name="MailerRecipient">
        	<key-map field-name="recipientId"/>
      	</relation>
      	<relation type="one" fk-name="MCS_TO_PSI" rel-entity-name="StatusItem">
        	<key-map field-name="printStatusId" rel-field-name="statusId"/>
      	</relation>
      	<relation type="one" fk-name="MCS_TO_ESI" rel-entity-name="StatusItem">
        	<key-map field-name="emailStatusId" rel-field-name="statusId"/>
      	</relation>
      	<relation type="one" fk-name="MCS_TO_CL" rel-entity-name="ContactList">
            <key-map field-name="contactListId"/>
        </relation>
    </entity>

    <entity entity-name="MailerImportMapper" package-name="net.intelliant.mailer" title="Mailer import mapper">
    	<field name="importMapperId" type="id-ne"/>
    	<field name="importMapperName" type="id-ne"/>
    	<field name="ofbizEntityName" type="id-ne"/>
    	<field name="description" type="description"/>
    	<field name="contentId" type="id-ne"/>
    	<field name="isFirstRowHeader" type="indicator"/>
    	<field name="createdByUserLogin" type="id-vlong"/>
      	<field name="lastModifiedByUserLogin" type="id-vlong"/>
    	<prim-key field="importMapperId"/>
    	<relation type="one" fk-name="MIM_TO_CNT" rel-entity-name="Content">
        	<key-map field-name="contentId"/>
      	</relation>
   	</entity>

   	<entity entity-name="MailerImportColumnMapper" package-name="net.intelliant.mailer" title="Stores mapping of XLS columns with entity columns">
   		<field name="importColumnMapperId" type="id-ne"/>
    	<field name="importMapperId" type="id-ne"/>
    	<field name="entityColName" type="id-ne"/>
    	<field name="importFileColIdx" type="id-ne"/>
    	<field name="createdByUserLogin" type="id-vlong"/>
      	<field name="lastModifiedByUserLogin" type="id-vlong"/>
    	<prim-key field="importColumnMapperId"/>    	
      	<relation type="one" fk-name="MICM_TO_MIM" rel-entity-name="MailerImportMapper">
        	<key-map field-name="importMapperId"/>
      	</relation>
   	</entity>
   	
   	<entity entity-name="MailerRecipientContactList" package-name="net.intelliant.mailer" title="Maintains relation between Mailer recipient and CL">
    	<field name="contactListId" type="id-ne"/>
    	<field name="recipientId" type="id-ne"/>    	
      	<relation type="one" fk-name="MRCL_TO_CL" rel-entity-name="ContactList">
        	<key-map field-name="contactListId"/>
      	</relation>
    	<relation type="one" fk-name="MRCL_TO_MR" rel-entity-name="MailerRecipient">
        	<key-map field-name="recipientId"/>
      	</relation>
    	<prim-key field="recipientId"/>
    	<prim-key field="contactListId"/>
   	</entity>
   	
   	<entity entity-name="MergeFormType" package-name="net.intelliant.mailer" title="Merge Form Type Entity">
		<field name="mergeFormTypeId" type="id-ne"></field>
		<field name="description" type="description"></field>
		<prim-key field="mergeFormTypeId"/>
    </entity>
   	
   	<!-- Views entities -->
   	<view-entity entity-name="MailerMarketingCampaignAndMarketingCampaignAppl" package-name="net.intelliant.mailer">
        <member-entity entity-alias="MC" entity-name="MarketingCampaign"/>
        <member-entity entity-alias="MMC" entity-name="MailerMarketingCampaign"/>
        <alias-all entity-alias="MC"/>
        <alias-all entity-alias="MMC"/>
        <view-link entity-alias="MC" rel-entity-alias="MMC" rel-optional="true">
            <key-map field-name="marketingCampaignId"/>
        </view-link>
    </view-entity>

    <view-entity entity-name="MailerMarketingCampaignAndMarketingCampaignAndStatusItem" package-name="net.intelliant.mailer">
        <member-entity entity-alias="MMC" entity-name="MailerMarketingCampaignAndMarketingCampaignAppl"/>
        <member-entity entity-alias="SI" entity-name="StatusItem"/>
        <alias-all entity-alias="MMC"/>
        <alias-all entity-alias="SI"/>
        <view-link entity-alias="MMC" rel-entity-alias="SI" rel-optional="true">
            <key-map field-name="statusId"/>
        </view-link>
    </view-entity>
    
	<view-entity entity-name="MailerMarketingCampaignAndContactListDetails" package-name="net.intelliant.mailer" title="mailer marketing campaign and contact list"> 
		<member-entity entity-alias="MMCCL" entity-name="MailerMarketingCampaignAndContactList"/>
		<member-entity entity-alias="CL" entity-name="MailerRecipientContactListCount"/>
		<alias-all entity-alias="CL">
			<exclude field="marketingCampaignId" />
		</alias-all>
		<alias-all entity-alias="MMCCL" />
		<view-link entity-alias="MMCCL" rel-entity-alias="CL">
			<key-map field-name="contactListId"/>
		</view-link>
	</view-entity>
	
	<view-entity entity-name="MailerRecipientContactListCount" package-name="net.intelliant.mailer" title="Counts the number of Contact List members">	
        <member-entity entity-alias="CL" entity-name="ContactList"/>
        <member-entity entity-alias="MRCL" entity-name="MailerRecipientContactList"/>       
        <alias entity-alias="CL" name="contactListName" group-by="contactListName"/>       
        <alias entity-alias="CL" name="contactListId" group-by="true"/>
        <alias entity-alias="CL" name="contactMechTypeId" />
        <alias entity-alias="MRCL" name="recipientId" function="count"/> 
        <view-link entity-alias="CL" rel-entity-alias="MRCL" rel-optional="true">
            <key-map field-name="contactListId" rel-field-name="contactListId"/>
        </view-link>
	</view-entity>
	
	<view-entity entity-name="MailerRecipientContactListContactListType" package-name="net.intelliant.mailer" title="Counts the number of Contact List members" >
		<member-entity entity-alias="MRCLC" entity-name="MailerRecipientContactListCount"/>
        <member-entity entity-alias="CMT" entity-name="ContactMechType"/>  
        <alias-all entity-alias="MRCLC"/>
        <alias-all entity-alias="CMT"/>
        <view-link entity-alias="MRCLC" rel-entity-alias="CMT" rel-optional="true">
            <key-map field-name="contactMechTypeId" rel-field-name="contactMechTypeId"/>
        </view-link>
	</view-entity>
	
	<view-entity entity-name="MailerRecipientContactListMerged" package-name="net.intelliant.mailer" title="Merged MailerRecipient and ContactList entities">	
        <member-entity entity-alias="CL" entity-name="ContactList"/>	
        <member-entity entity-alias="MR" entity-name="MailerRecipient"/>
        <member-entity entity-alias="MRCL" entity-name="MailerRecipientContactList"/>
        <alias-all entity-alias="CL"/>
        <alias-all entity-alias="MR"/>
        <alias-all entity-alias="MRCL"/>
        
        <view-link entity-alias="MRCL" rel-entity-alias="CL" rel-optional="true">
            <key-map field-name="contactListId" rel-field-name="contactListId"/>
        </view-link>
        <view-link entity-alias="MRCL" rel-entity-alias="MR" rel-optional="true">
            <key-map field-name="recipientId" rel-field-name="recipientId"/>
        </view-link>
	</view-entity>
</entitymodel>